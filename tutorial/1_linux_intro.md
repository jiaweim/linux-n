# Linux 概述

2023-05-05
***

## 简介

Linux 系统主要包含四个部分：

1. Linux 内核（kernel）
2. GNU 工具
3. 图形桌面环境
4. 应用软件

## Linux 内核

Linux 系统的核心就是内核（kernel）。内核控制系统上的所有硬件和软件，并在需要时分配硬件及执行软件。

内核主要负责四个功能：

- 系统内存管理
- 软件管理
- 硬件管理
- 文件系统管理

### 系统内存管理

内存管理是操作系统内核的主要功能之一。除了服务器上可用的物理内存，内核还可以创建和管理虚拟内存。

内核通过使用硬盘上的空间（交换空间，*swap space*）实现**虚拟内存**。内核在交换空间和实际物理内存之间来回交换虚拟内存位置的内容，实现了扩充物理内存的效果。

内存位置被分成不同块（block），称为**页面**（*pages*）。内核在物理内存或虚拟内存（交换空间）定位每个内存页，并维护一个内存页面表，该表指示哪些页面在物理内存，哪些页面被交换到磁盘。

内核跟踪正在使用的内存页，并自动将一段时间未被访问的内存页复制到交换空间，该操作称为**换出**（*swapping out*），即使有空余物理内存，也会执行换出操作。当程序需要访问已换出的内存页，内核必须在物理内存中为其腾出空间，即将其它内存页换出，然后**换入**所需页面。分区对换（*swapping in/out*）需要时间，因此会减慢正在运行的进程。

### 软件管理

Linux 系统将正在运行的程序称为进程（*process*）。进程可以在前台运行，在显示器上显示输出，也可以在后台运行。内核控制 Linux 系统管理系统上运行的所有进程。

内核创建的第一个进程称为初始化进程（*init process*），负责启动系统上所有的其它进程。当内核启动时，它将 init 进程加载到虚拟内存。当内核启动每个额外进程时，都会在虚拟内存中为该进程提供一个唯一区域来存储该进程使用的数据和代码。

init 进程有多种实现，目前最流行两种：

- **SysVinit**：*SysVinit* (*SysV*) 初始化方法基于 Unix System V 初始化方法，是 Linux 最初使用的方法。尽管现在很多 Linux 发行版不再使用，在较老的 Linux 发行版中依然能找到。
- **Systemd**：*systemd* 初始化方法在 2010 年创建，是目前 Linux 发行版中最流行的进程初始化和管理系统。

SysVinit 初始化方法使用运行级别（*runlevels*）来确定启动哪些进程。runlevel 定义了 Linux 系统的运行状态，以及在每个状态下应该运行哪些进程。下表显示了与 SysVinit 初始化相关的不同运行级别。

| Runlevel | 说明                       |
| -------- | -------------------------- |
| 0        | 关闭系统                   |
| 1        | 单用户模式，用于系统维护   |
| 2        | 多用户模式，未启用网络服务 |
| 3        | 多用户模式，启用网络服务   |
| 4        | 自定义                     |
| 5        | 多用户模式，GUI 可用       |
| 6        | 重启系统                   |

`/etc/inittab` 文件定义了系统的默认 runlevel。在 `/etc/rc.d` 目录的子目录中为特定 runlevel 定义了启动的进程。使用 `runlevel` 命令可以查看当前 runlevel：

```bash
$ runlevel
```

systemd 初始化方法之所以流行，是因为它能够根据不同的事件启动进程：

- 系统启动时
- 连接特定硬件设备时
- 启动服务时
- 创建网络连接时

systemd 通过将事件与 *unit* 文件链接来决定运行哪些进程。每个 unit 文件定义了当指定事件发生时要启动的程序。`systemctl` 程序可用来启动、停止和列出当前在系统上运行的 unit 文件。

systemd 将 unit 文件组合成 *targets*。target 定义了 Linux 系统的特定运行状态，与 SysVinit 的 runlevel 概念类似。在系统启动时，`default.target` 定义了所有要启动的 unit 文件。`systemctl` 命令可用来查看当前默认 target：

```bash
$ systemctl get-default
graphical.target
```

`graphical.target` 定义了多用户图形环境运行时要启动的进程，类似 SysVinit 的 runlevel 5.

### 硬件管理

内核的另一职责是硬件管理。Linux 系统和与之通信的任何设备都需要驱动程序代码。驱动程序代码允许内核与设备之间来回传递数据，充当应用程序和硬件之间的媒介。在 Linux 内核中插入设备驱动程序代码的方法有两种：

- 将驱动编译进内核
- 内核中添加驱动模块

以前只能通过重新编译内核来插入驱动程序代码。每次向系统添加新设备，都必须重新编译内核代码。随着 Linux 内核支持的硬件越来越多，该过程越来越低效。因此，Linux 开发人员设计了另一种更便捷的方法。

程序员开发了内核模块的概念，允许将驱动程序代码插入正在运行的内核中，而不必重新编译内核。另外，当设备使用完毕后，可以从内核中删除内核模块。这极大简化和扩展了 Linux 硬件。

Linux 系统将硬件设备识别为特殊的文件，称为设备文件（device file）。设备文件有三类：

- Character
- Block
- Network

字符（Character）设备文件适用于一次只能处理一个字符的设备。大多数类型的调制解调器和终端都是字符设备文件。块（Block）文件适用于一次可以处理大块数据的设备，如 disk 驱动。

网络（Network）设备文件类型用于使用报文发送和接受数据的设备。包括网卡和一些特殊的环回设备，它允许 Linux 系统使用通用网络编程协议与自身通信。

Linux 为系统上的每个设备创建一个称为节点（node）的特殊文件。与设备的通信都通过设备节点进行。每个节点有一个唯一数字对，由 Linux 内核识别。该数字对包含一个主设备号（major）和一个副设备号（minor）。相似的设备被归到相同的 major 设备号，minor 设备号用于标识 majow 设备号下的特定设备。

### 文件系统管理

与其它一些操作系统不同，Linux 内核支持不同类型的文件系统，以便从硬盘驱动读写数据。除了自带的十多个文件系统，Linux 还可以读写其它操作系统（如 Windows）的文件系统。下表列出了 Linux 可用来读写数据的标准文件系统：

| 文件系统 | 说明                                            |
| -------- | ----------------------------------------------- |
| ext      | Linux 扩展文件系统（原始的 Linux 文件系统）     |
| ext2     | 第二版扩展文件系统，相对 ext 提供了更多高级功能 |
| ext3     | 第三版扩展文件系统，支持日志                    |
| ext4     | 第四版扩展文件系统，支持高级日志                |
| btrfs    | 新的高性能文件系统，支持日志和大文件            |
| exfat    | 扩展 Windows 文件系统，主要用于 SD 卡和 USB     |
| hpfs     | OS/2 高性能文件系统                             |
| jfs      | IBM 的日志文件系统                              |
| iso9660  | ISO 9660 文件系统（CD-ROMs）                    |
| minix    | MINIX 文件系统                                  |
| msdos    | Microsoft FAT16                                 |
| ncp      | NetWare 文件系统                                |
| nfs      | Network 文件系统                                |
| ntfs     | 支持 Microsoft NT 文件系统                      |
| proc     | 访问系统信息                                    |
| smb      | 用于网络访问的 Samba SMB 文件系统               |
| sysv     | 老的 Unix 文件系统                              |
| ufs      | BSD 文件系统                                    |
| umsdos   | msdos 上的类 Unix 文件系统                      |
| vfat     | Windows 95 文件系统（FAT32）                    |
| XFS      | 高性能 64-bit 日志文件系统                      |

Linux 服务器要访问的任何硬盘启动都必须使用上表列出的文件系统之一进行格式化。

Linux 内核使用虚拟文件系统（VFS）与其它文件系统进行交互。这为内核与其它任何文件系统的通信提供了一个标准接口。当文件系统被挂载到 Linux 上时，VFS 会在内存中缓存信息。

## GNU 工具

除了内核来控制硬件设备，操作系统还需要实用程序来指定具体功能，如文件操作。

GNU （GNU's Not Unix）组织开发了一套完整的 Unix 实用程序，它们遵循开源代码软件（Open Source Software, OSS）精神。尽管一般将 Linux 内核和 GNU 程序组合整体称为 Linux，但一些 Linux 纯粹主义者更愿意将其称为 GNU/Linux 系统，以表彰 GNU 组织对 Linux 的贡献。

### GNU 核心工具

GNU 项目主要为 Unix 系统管理员设计，以便拥有一个类 Unix 环境。这导致该项目移植了许多常见的 Unix 系统命令程序。为 Linux 系统提供的核心 GNU 程序包称为 `coreutils` 包。

GNU coreutils 包由三部分组成：

- 文件处理工具
- 文本操作工具
- 进程管理工具

### Shell

GNU/Linux shell 是一个特殊的交互式应用程序。它为用户提供了启动程序、管理文件系统上的文件以及管理 Linux 系统上运行的进程的方法。Shell 允许你输入文本命令，然后解析这些命令并在内核中执行。

shell 包含一组内部命令，用于实现文件复制、移动、重命名、显示系统上运行的程序等诸多任务。除了内部命令，shell 还支持输入程序名称，shell 将程序名称传递给内核以启动它。

也可以将一组 shell 命令放到文件作为程序执行。这些文件称为 *shell 脚本*。可以从命令行执行的任何命令都可以放在 shell 脚本中。这为常用命令或需要多个命令组合使用的进程提供了极大的灵活性。

在 Linux 上有许多种 shell 可用。不同的 shell 具有不同特性，有些更适用于创建脚本，有些更适合于管理进程。所有 Linux 发行版中使用的默认 shell 是 Bash shell。Bash shell 是由  GNU 项目开发，作为标准 Unix shell 的替代品，称为 Bourne shell。

| Shell | 说明                                                                           |
| ----- | ------------------------------------------------------------------------------ |
| ash   | 一个简单、轻量级的 shell，在低内存环境中运行，与 Bash shell 完全兼容           |
| korn  | 一个与 Bash shell 兼容的程序 shell，支持高级编程特性，如关联数组、浮点运算     |
| tcsh  | 将 C 语言嵌入到 shell 脚本的 shell                                             |
| zsh   | 高级 shell，集成 Bash, tcsh, korn 的特性，提供高级编程特性、共享历史文件和提示 |

大多数 Linux 发行版包含多个 shell。

## Linux 桌面环境

早期 Linux (1990s) 只有简单的文本界面，可用来启动程序、控制程序操作以及在系统上移动文件。

随着 Microsoft Windows 的普及，用户对界面的要求提高，刺激了 OSS 社区开发了 Linux 图形桌面。

Linux 以为每个任务提供多种实现方式而闻名，这点在图形化桌面上也是如此。下面介绍一些比较流行的图形桌面。

### X Window

图形环境需要两个基本元素：显卡和显示器。要在计算机上显示精美的图形，Linux 软件需要知道如何与这两者通信。

X Window 软件是呈现图形的核心元素。X Window 是一个底层软件，它直接与 PC 的显卡与显示器交互，并控制 Linux 程序呈现图形。Linux 不是唯一使用 X Window 的操作系统。

在 Linux 中最常用的两个 X Window 包：

- X.org
- Wayland

X.org 比较老，基于原始的 Unix X Window System version 11 (X11) 实现。很多 Linux 发行版都在向 Wayland 迁移，它更安全、更易于维护。

在第一次安装 Linux 时，它会尝试检测你的显卡和显示器，然后创建一个包含所需信息的 X Window 配置文件。在安装过程中，你可能会注意到安装程序扫描显示器以支持图形化模式。该扫描有时会导致显示器出现几秒的空白。因此市面上有许多不同类型的显卡和显示器，所以这个过程需要一点时间。

核心的 X Window 只产生以图形显示环境，没有提供操作文件或启动程序的桌面环境。这对运行单个程序来说还行，但不适合日常使用。因此，在 X Window 系统软件上，还需要一个桌面环境。

### KDE Plasma 桌面

K Desktop Environment (KDE) 于 1996 年首次作为一个开源项目发布，用于生成类似 Windows 的图形化桌面。下图是 KDE Plasma 版本：

![[Pasted image 20230505154848.png]]

KDE Plasma 桌面允许将程序和文件图标放在桌面上的一个特殊区域。点击程序图标启动程序，单击文件图标 KDE 会尝试使用关联程序打开该文件。

桌面底部称为面板（Panel）。面板包含四部分：

- **K menu**：与 Windows 的开始菜单类似，K menu 包含启动已安装程序的链接。
- **程序快捷键**：从面板直接启用应用程序的快速链接。
- **任务栏**：显示当前在桌面上运行的应用程序的图标。
- **Applets**：有些应用程序在面板上有一个图标，可以根据程序运行状态更改显示信息。

所有的面板特性都可以在 Windows 上看到类似的。除了桌面特性，KDE 项目还提供了许多在 KDE 环境中运行的软件。

### GNOME 桌面

GNU Network Object Model Environment (GNOME) 是另一个流行的 Linux 桌面环境。GENOME 于 1999 年首次发布，现已成为许多 Linux 发行版的默认桌面环境。下图是 Ubuntu Linux 发行版中 GNOME 桌面视图：

![[Pasted image 20230505160714.png]]

GENOME 3 桌面将可用菜单减少到三个：

- **Activities**：显示收藏夹和正在运行的程序图标
- **Calendar**：显示当前日期/时间，以及系统通知消息
- **System**：显示网络连接、系统设置和重启启动的选项

GNOME 3 被设计成可以在多种不同类型的设备上工作，所以菜单不多。要启动程序，必须使用 Activities Overview 搜索程序。

为了不被 KDE 超越，GNOME 开发人员还开发了而许多与 GNOME 桌面集成的图形化应用程序。

### 其它桌面

Linux 的主要特性就是选择多，Linux 世界有大量不同类型的图形桌面可用。

GNOME 3 彻底改变其界面，许多喜欢 GNOME 2 的开发人员创建了基于 GNOME 2 的衍生版本。其中两种比较受欢迎：

- **Cinnamon**：Cinnamon 桌面是 2011 年由 Linux Mint 发行版开发，旨在开发 GNOME 2 桌面。它目前在几个 Linux 发行版中作为选项出现，包括 Ubuntu Fedora 和 openSUSE。
- **MATE**：MATE 桌面是在 2011 年由一个不喜欢 GNOME 3 的 Arch Linux 用户开发。它合并了 GNOME 3 的 一些特性，如替换任务栏，但保持了 GNOME 2 的整体外观。

下图是 Linux Mint 中 Cinnamon 桌面效果：

![[Pasted image 20230505162734.png]]

这些花哨桌面的缺点是需要大量的系统资源才能运行。在 Linux 的早期，它的一个标志和卖点就是能够在较老的、功能较弱的个人电脑上运行，而新的微软桌面不能。然而，随着 KDE Plasma 和 GNOME 3 的流行，这种情况发生了改变，因为它们占用了同样多的内存。

针对该情况，Linux 开发人员创建了几个低内存的图形桌面。尽管它们没有那么多功能，但能够运行许多基本的图形化程序，包括文字处理、电子表格、数据库、绘图，以及多媒体支持等。

下表总结了一些可以在低性能电脑上使用的小型 Linux 图形桌面环境：

| 桌面    | 说明                                                     |
| ------- | -------------------------------------------------------- |
| Fluxbox | 没有面板，只有一个弹出菜单来启动程序                     |
| Xfce    | 类似 GNOME 2，但在低内存环境图形更少                     |
| JWM     | Joe's Window Manager，轻量级桌面，适合低内存、低磁盘环境 |
| fvwm    | 支持虚拟桌面和面板等高级桌面特性，但能在低内存环境运行   |
| fvwm95  | 派生自 fvwm，但看起来像 Windows 95                       |

这些图形桌面环境不像 KDE 和 GNOME 3 那样花哨，但是提供了基本的图形功能。

## Linux 发行版

有了 Linux 所需的四个主要组件，那么如何将它们组合成一个 Linux 系统？很多人在做这方面的工作。

一个完整的 Linux 系统包称为发行版（distribution）。大多数发行版都是为特性用户群体定制，例如商业用户、多媒体爱好者、软件开发人员或普通家庭用户。每个定制的发行版都包含支持特定功能所需的软件包，例如，针对多媒体爱好者的音频和视频编辑软件，针对软件开发人员的编译器和集成开发环境。

不同 Linux 发行版通常分为两类：

- Core Linux 发行版
- Specialized 发行版

### Core Linux 发行版

Core Linux 发行版包含一个内核、一个或多个图形化桌面环境，以及为内核预编译的几乎所有可用的 Linux 应用程序。它为完整的 Linux 安装提供了一站式服务。下表是一些流行的 Core Linux 发行版。

| 发行版             | 说明                                               |
| ------------------ | -------------------------------------------------- |
| Slackware          | 最初的 Linux 发行版之一，受 Linux 爱好者欢迎       |
| Red Hat Enterprise | 主要用于网络服务的商业发行版                       |
| Gentoo             | 为 Linux 高级用户设计的发行版，只包含 Linux 源代码 |
| openSUSE           | 为企业和家庭设计不同的发行版                       |
| Debian             | 深受 Linux 专家和商业用户喜欢                      |

现在 Linux 发行版主要以 ISO 镜像文件格式发布。可以使用软件将 ISO 镜像文件刻录到 DVD 或创建一个可引导的 U 盘。然后，只需从 DVD 或 U 盘启动就可以安装 Linux。

然而，对初学者来说安装 Core Linux 发行版依然存在问题。为了覆盖人们可能想要使用 Linux 的任何场景，单个发行版必须包含许多应用程序，从高端互联网数据库服务器到普通游戏。

在发行版中包含更多选项对 Linux geek 来说可能是好事，但对初学者就是场噩梦。大多数 Core Linux 发行版在安装时都会询问一堆问题，以确定默认情况下要加载哪些程序，连接到 PC 的硬件以及如何配置硬件。

因此，对初学者来说，还有一种更简单的安装 Linux 的方式。

### Specialized Linux 发行版

Specialized Linux 发行版通常基于一个主要发行版，但只包含对特定领域有意义的软件集。

除了提供专门的软件（如企业用户的办公软件）之外，定义的 Linux 发行版视图通过自动检测和自动配置通用硬件来帮助 Linux 初学者。这使得安装 Linux 更容易。

下表总结了一些 Specialized Linux 发行版以及它们的专长。

| 发行版      | 说明                                             |
| ----------- | ------------------------------------------------ |
| Fedora      | 从 Red Hat Enterprise Linux 源码构建的免费发行版 |
| Ubuntu      | 为学校和家庭提供的免费发行版                     |
| MX Linux    | 为家庭提供的免费发行版                           |
| Linux Mint  | 为家庭娱乐用户提供的免费发行版                   |
| Puppy Linux | 一个免费的小型发行版，在老的 PC 上可以良好运行   |

网上还有大量的 Linux 发行版，无论您的专业是什么，都有适合你的 Linux 发行版。
